# AIP DEX Trading Bot - ç­‰å¾…é…ç½®å¯åŠ¨é€»è¾‘

## æ¦‚è¿°

æ–°çš„å¯åŠ¨é€»è¾‘å…è®¸æœºå™¨äººåœ¨æ²¡æœ‰é…ç½® owner å’Œ strategy çš„æƒ…å†µä¸‹å¯åŠ¨ï¼Œç„¶åç­‰å¾…é…ç½®å®Œæˆåå†å¼€å§‹äº¤æ˜“ã€‚

## ä¸»è¦åŠŸèƒ½

### 1. çµæ´»çš„æœºå™¨äººå¯åŠ¨

æœºå™¨äººå¯ä»¥åœ¨ä»¥ä¸‹ä¸¤ç§æ¨¡å¼ä¸‹å¯åŠ¨ï¼š

#### æ¨¡å¼Aï¼šç«‹å³é…ç½®ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰
```python
bot_config = {
    "bot_name": "My Bot",
    "account_address": "0x1234567890abcdef1234567890abcdef12345678",
    "chain": "bsc",
    "initial_balance_usd": 5000.0,
    "owner_id": owner.id,        # ç«‹å³é…ç½®
    "strategy_id": strategy.id,   # ç«‹å³é…ç½®
    "is_active": True
}
```

#### æ¨¡å¼Bï¼šçµæ´»å¯åŠ¨ï¼ˆæ–°æ–¹å¼ï¼‰
```python
bot_config = {
    "bot_name": "My Bot",
    "account_address": "0x1234567890abcdef1234567890abcdef12345678",
    "chain": "bsc",
    "initial_balance_usd": 5000.0,
    # ä¸æä¾› owner_id å’Œ strategy_id
    "is_active": True
}
```

### 2. ç­‰å¾…é…ç½®å®Œæˆ

å½“æœºå™¨äººæ²¡æœ‰é…ç½® owner å’Œ strategy æ—¶ï¼Œç³»ç»Ÿä¼šï¼š

1. **æ£€æŸ¥é…ç½®çŠ¶æ€**ï¼šæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æœºå™¨äººæ˜¯å¦å·²é…ç½®
2. **æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯**ï¼šæ˜¾ç¤ºå½“å‰çš„ owner_idã€strategy_id å’Œé…ç½®çŠ¶æ€
3. **ç­‰å¾…é…ç½®**ï¼šç›´åˆ°æœºå™¨äººè¢«é…ç½®åæ‰å¼€å§‹äº¤æ˜“
4. **ä¼˜é›…é€€å‡º**ï¼šæ”¯æŒ Ctrl+C ä¸­æ–­ç­‰å¾…

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œå‚æ•°

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®å¹¶ç­‰å¾…é…ç½®å®Œæˆ
python run_bot.py --default --wait-config

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶å¹¶ç­‰å¾…é…ç½®å®Œæˆ
python run_bot.py --config my_config.json --wait-config

# è‡ªå®šä¹‰æ£€æŸ¥é—´éš”ï¼ˆé»˜è®¤5åˆ†é’Ÿï¼‰
python run_bot.py --default --wait-config --check-interval 10

# ä¸ä½¿ç”¨ç­‰å¾…æ¨¡å¼ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰
python run_bot.py --default
```

### å‚æ•°è¯´æ˜

- `--wait-config`: å¯ç”¨ç­‰å¾…é…ç½®æ¨¡å¼
- `--check-interval`: è®¾ç½®æ£€æŸ¥é—´éš”ï¼ˆåˆ†é’Ÿï¼‰ï¼Œé»˜è®¤5åˆ†é’Ÿ
- `--config`: æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„
- `--default`: ä½¿ç”¨é»˜è®¤é…ç½®

## é…ç½®æ£€æŸ¥é€»è¾‘

### æ£€æŸ¥æ¡ä»¶

æœºå™¨äººè¢«è®¤ä¸ºå·²é…ç½®å½“ä¸”ä»…å½“ï¼š
- `is_configured = True`
- `owner_id` ä¸ä¸ºç©º
- `strategy_id` ä¸ä¸ºç©º

### æ£€æŸ¥æµç¨‹

1. **åˆå§‹åŒ–æ£€æŸ¥**ï¼šå¯åŠ¨æ—¶æ£€æŸ¥æœºå™¨äººé…ç½®çŠ¶æ€
2. **å¾ªç¯ç­‰å¾…**ï¼šå¦‚æœæœªé…ç½®ï¼Œæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
3. **çŠ¶æ€æ˜¾ç¤º**ï¼šæ¯æ¬¡æ£€æŸ¥éƒ½æ˜¾ç¤ºè¯¦ç»†çš„é…ç½®çŠ¶æ€
4. **å¼€å§‹äº¤æ˜“**ï¼šä¸€æ—¦é…ç½®å®Œæˆï¼Œç«‹å³å¼€å§‹äº¤æ˜“å¾ªç¯

## ç¤ºä¾‹è¾“å‡º

### æœªé…ç½®çŠ¶æ€
```
ğŸ”„ Configuration check #1 at 2024-01-15 10:30:00
â³ Bot is not configured:
   Owner ID: None
   Strategy ID: None
   Is Configured: False
â³ Next check in 5 minutes...
```

### å·²é…ç½®çŠ¶æ€
```
ğŸ”„ Configuration check #3 at 2024-01-15 10:40:00
âœ… Bot is configured:
   Owner ID: 550e8400-e29b-41d4-a716-446655440000
   Strategy ID: 550e8400-e29b-41d4-a716-446655440001
   Strategy Type: moderate
âœ… Bot is ready to start trading!
```

## é…ç½®æœºå™¨äºº

### æ–¹æ³•1ï¼šä½¿ç”¨ TradingService.configure_bot()

```python
from services.trading_service import TradingService

trading_service = TradingService()
configured_bot = await trading_service.configure_bot(
    db, bot.id, owner.id, strategy.id
)
```

### æ–¹æ³•2ï¼šç›´æ¥æ›´æ–°æ•°æ®åº“

```python
bot = db.query(TradingBot).filter(TradingBot.id == bot_id).first()
bot.owner_id = owner_id
bot.strategy_id = strategy_id
bot.is_configured = True
db.commit()
```

## æ¼”ç¤ºè„šæœ¬

è¿è¡Œæ¼”ç¤ºè„šæœ¬æ¥ä½“éªŒå®Œæ•´çš„åŠŸèƒ½ï¼š

```bash
python example_wait_config.py
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. åˆ›å»ºä¸€ä¸ª owner å’Œ strategy
2. åˆ›å»ºä¸€ä¸ªæœªé…ç½®çš„æœºå™¨äºº
3. æ¨¡æ‹Ÿç­‰å¾…è¿‡ç¨‹
4. é…ç½®æœºå™¨äºº
5. æ˜¾ç¤ºé…ç½®ç»“æœ

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯

1. **æœºå™¨äººæœªæ‰¾åˆ°**
   ```
   âŒ Bot with ID xxx not found
   ```

2. **é…ç½®æ£€æŸ¥å¤±è´¥**
   ```
   âŒ Error checking bot configuration: xxx
   ```

3. **æ•°æ®åº“è¿æ¥é”™è¯¯**
   ```
   âŒ Failed to initialize database
   ```

### è°ƒè¯•æŠ€å·§

1. æ£€æŸ¥æ•°æ®åº“è¿æ¥
2. éªŒè¯æœºå™¨äººIDæ˜¯å¦æ­£ç¡®
3. ç¡®è®¤ owner å’Œ strategy æ˜¯å¦å­˜åœ¨
4. æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

## æœ€ä½³å®è·µ

### 1. å¯åŠ¨é¡ºåº

1. å…ˆåˆ›å»º owner å’Œ strategy
2. å¯åŠ¨æœºå™¨äººï¼ˆå¯é€‰é…ç½®ï¼‰
3. é…ç½®æœºå™¨äººï¼ˆå¦‚æœæœªç«‹å³é…ç½®ï¼‰
4. æœºå™¨äººè‡ªåŠ¨å¼€å§‹äº¤æ˜“

### 2. ç›‘æ§é…ç½®

- ä½¿ç”¨ `--check-interval` è°ƒæ•´æ£€æŸ¥é¢‘ç‡
- ç›‘æ§æ—¥å¿—æ–‡ä»¶äº†è§£é…ç½®çŠ¶æ€
- è®¾ç½®é€‚å½“çš„å‘Šè­¦æœºåˆ¶

### 3. é”™è¯¯æ¢å¤

- æœºå™¨äººä¼šè‡ªåŠ¨é‡è¯•é…ç½®æ£€æŸ¥
- æ”¯æŒä¼˜é›…çš„ä¸­æ–­å’Œé‡å¯
- ä¿æŒæ•°æ®åº“è¿æ¥çš„å¥åº·çŠ¶æ€

## æŠ€æœ¯ç»†èŠ‚

### æ£€æŸ¥é—´éš”

- é»˜è®¤ï¼š5åˆ†é’Ÿ
- å¯é…ç½®ï¼š1-60åˆ†é’Ÿ
- æ”¯æŒç§’çº§ç²¾åº¦

### æ•°æ®åº“æŸ¥è¯¢

```sql
SELECT id, owner_id, strategy_id, is_configured 
FROM trading_bots 
WHERE id = ?
```

### é…ç½®éªŒè¯

```python
is_configured = bot.is_configured and bot.owner_id and bot.strategy_id
```

## æ€»ç»“

æ–°çš„ç­‰å¾…é…ç½®å¯åŠ¨é€»è¾‘æä¾›äº†ï¼š

- **çµæ´»çš„éƒ¨ç½²**ï¼šæ”¯æŒåˆ†é˜¶æ®µé…ç½®å’Œéƒ¨ç½²
- **è‡ªåŠ¨æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹é…ç½®çŠ¶æ€å˜åŒ–
- **ç”¨æˆ·å‹å¥½**ï¼šæ¸…æ™°çš„çŠ¶æ€æ˜¾ç¤ºå’Œè¿›åº¦æç¤º
- **å¯é…ç½®æ€§**ï¼šå¯è°ƒæ•´æ£€æŸ¥é—´éš”å’Œç­‰å¾…è¡Œä¸º
- **é”™è¯¯æ¢å¤**ï¼šå¥å£®çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

è¿™ä¸ªç³»ç»Ÿä¸ºäº¤æ˜“æœºå™¨äººæä¾›äº†æ›´çµæ´»å’Œç”¨æˆ·å‹å¥½çš„å¯åŠ¨ä½“éªŒã€‚ 